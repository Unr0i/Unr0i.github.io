---
layout:     post
title:      数据解密系列3
subtitle:   思智泰克加密算法逆向与还原
date:       2023-06-11
author:     LanKai
header-img: img/post-bg-debug.png
catalog: true
tags:
    - Windows
    - 逆向
    - 加密算法还原
---


## 主题

   逆向分析还原思智泰克加密算法

### 正文

   - 加密文件格式设计弊大于利，加密文件头部特征长度不固定，填充了大量垃圾数据，对于文件超大超多的用户影响较大，占用较多的磁盘空间
   - 加密文件分段进行，会进行乱序，解密时要根据文件提供的起始偏移和长度重整顺序，合并
   - 加密文件头特征存放位置不固定，除末尾的0x1000为固定长度内容外，其他可出现在文件头、文件中间、尾部等位置

#### 1、定位

 - 根据加密文件内容，分析出共性特征，末尾0x1000字节存有所需文件偏移
 - 使用进程监控工具记录加解密操作
 - 查看关键函数的调用栈，逐步锁定关键模块和函数

#### 2、动静结合
  - 使用IDA分析函数调用栈中的关键逻辑
  - 使用x64dbg动态调试相应的逻辑
  - 结合分析出加密函数的参数、返回值、所用密钥等

#### 3、算法还原
  - 第一步:处理加密文件头、获取偏移和文件实际大小等信息
  - 第二步：根据文件加密块偏移和大小解密后重组成明文文件
    
